<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="809px" preserveAspectRatio="none" style="width:1173px;height:809px;background:#FFFFFF;" version="1.1" viewBox="0 0 1173 809" width="1173px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="497.2578" style="stroke:#000000;stroke-width:1.5;" width="1156.2275" x="10" y="211.7852"/><rect fill="none" height="353.4629" style="stroke:#000000;stroke-width:1.5;" width="1136.2275" x="20" y="269.3672"/><rect fill="none" height="209.668" style="stroke:#000000;stroke-width:1.5;" width="1116.2275" x="30" y="326.9492"/><g><title>Reader</title><rect fill="#000000" fill-opacity="0.00000" height="642.4219" width="8" x="61.9585" y="83.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="65" x2="65" y1="83.6211" y2="726.043"/></g><g><title>LendingController</title><rect fill="#000000" fill-opacity="0.00000" height="642.4219" width="8" x="317.9082" y="83.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="321.6499" x2="321.6499" y1="83.6211" y2="726.043"/></g><g><title>LendingService</title><rect fill="#000000" fill-opacity="0.00000" height="642.4219" width="8" x="571.6616" y="83.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="575.4067" x2="575.4067" y1="83.6211" y2="726.043"/></g><g><title>LendingRepository</title><rect fill="#000000" fill-opacity="0.00000" height="642.4219" width="8" x="878.2148" y="83.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="881.8428" x2="881.8428" y1="83.6211" y2="726.043"/></g><g><title>RecommendationRepository</title><rect fill="#000000" fill-opacity="0.00000" height="642.4219" width="8" x="1040.9072" y="83.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1044.5869" x2="1044.5869" y1="83.6211" y2="726.043"/></g><g class="participant participant-head" data-participant="Reader"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.917" x="40" y="80.1074">Reader</text><ellipse cx="65.9585" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M65.9585,21.5 L65.9585,48.5 M52.9585,29.5 L78.9585,29.5 M65.9585,48.5 L52.9585,63.5 M65.9585,48.5 L78.9585,63.5" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Reader"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.917" x="40" y="740.1504">Reader</text><ellipse cx="65.9585" cy="752.1641" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M65.9585,760.1641 L65.9585,787.1641 M52.9585,768.1641 L78.9585,768.1641 M65.9585,787.1641 L52.9585,802.1641 M65.9585,787.1641 L78.9585,802.1641" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="C"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.5166" x="259.6499" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.5166" x="266.6499" y="72.1074">LendingController</text></g><g class="participant participant-tail" data-participant="C"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.5166" x="259.6499" y="725.043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.5166" x="266.6499" y="747.1504">LendingController</text></g><g class="participant participant-head" data-participant="S"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110.5098" x="520.4067" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.5098" x="527.4067" y="72.1074">LendingService</text></g><g class="participant participant-tail" data-participant="S"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110.5098" x="520.4067" y="725.043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.5098" x="527.4067" y="747.1504">LendingService</text></g><g class="participant participant-head" data-participant="LR"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.7441" x="820.8428" y="80.1074">LendingRepository</text><path d="M864.2148,29 C864.2148,19 882.2148,19 882.2148,19 C882.2148,19 900.2148,19 900.2148,29 L900.2148,55 C900.2148,65 882.2148,65 882.2148,65 C882.2148,65 864.2148,65 864.2148,55 L864.2148,29" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M864.2148,29 C864.2148,39 882.2148,39 882.2148,39 C882.2148,39 900.2148,39 900.2148,29" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-tail" data-participant="LR"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.7441" x="820.8428" y="740.1504">LendingRepository</text><path d="M864.2148,753.6641 C864.2148,743.6641 882.2148,743.6641 882.2148,743.6641 C882.2148,743.6641 900.2148,743.6641 900.2148,753.6641 L900.2148,779.6641 C900.2148,789.6641 882.2148,789.6641 882.2148,789.6641 C882.2148,789.6641 864.2148,789.6641 864.2148,779.6641 L864.2148,753.6641" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M864.2148,753.6641 C864.2148,763.6641 882.2148,763.6641 882.2148,763.6641 C882.2148,763.6641 900.2148,763.6641 900.2148,753.6641" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-head" data-participant="RR"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176.6406" x="953.5869" y="80.1074">RecommendationRepository</text><path d="M1026.9072,29 C1026.9072,19 1044.9072,19 1044.9072,19 C1044.9072,19 1062.9072,19 1062.9072,29 L1062.9072,55 C1062.9072,65 1044.9072,65 1044.9072,65 C1044.9072,65 1026.9072,65 1026.9072,55 L1026.9072,29" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1026.9072,29 C1026.9072,39 1044.9072,39 1044.9072,39 C1044.9072,39 1062.9072,39 1062.9072,29" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-tail" data-participant="RR"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176.6406" x="953.5869" y="740.1504">RecommendationRepository</text><path d="M1026.9072,753.6641 C1026.9072,743.6641 1044.9072,743.6641 1044.9072,743.6641 C1044.9072,743.6641 1062.9072,743.6641 1062.9072,753.6641 L1062.9072,779.6641 C1062.9072,789.6641 1044.9072,789.6641 1044.9072,789.6641 C1044.9072,789.6641 1026.9072,789.6641 1026.9072,779.6641 L1026.9072,753.6641" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1026.9072,753.6641 C1026.9072,763.6641 1044.9072,763.6641 1044.9072,763.6641 C1044.9072,763.6641 1062.9072,763.6641 1062.9072,753.6641" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="message" data-participant-1="Reader" data-participant-2="C"><polygon fill="#181818" points="309.9082,130.2031,319.9082,134.2031,309.9082,138.2031,313.9082,134.2031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="65.9585" x2="315.9082" y1="134.2031" y2="134.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.9897" x="72.9585" y="111.6494">POST /api/lendings/return/{id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231.9497" x="72.9585" y="128.9404">?recommended=true/false&amp;comment=...</text></g><g class="message" data-participant-1="C" data-participant-2="S"><polygon fill="#181818" points="563.6616,161.4941,573.6616,165.4941,563.6616,169.4941,567.6616,165.4941" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="321.9082" x2="569.6616" y1="165.4941" y2="165.4941"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229.7534" x="328.9082" y="160.2314">returnById(id, recommended, comment)</text></g><g class="message" data-participant-1="S" data-participant-2="LR"><polygon fill="#181818" points="870.2148,192.7852,880.2148,196.7852,870.2148,200.7852,874.2148,196.7852" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="575.6616" x2="876.2148" y1="196.7852" y2="196.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282.5532" x="582.6616" y="191.5225">findByIdAndReturnedDateIsNull(id)  &#171;for update&#187;</text></g><path d="M10,211.7852 L70.1709,211.7852 L70.1709,221.0762 L60.1709,231.0762 L10,231.0762 L10,211.7852" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="497.2578" style="stroke:#000000;stroke-width:1.5;" width="1156.2275" x="10" y="211.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="25" y="226.8135">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="114.2754" x="85.1709" y="225.6553">[active lending found]</text><g class="message" data-participant-1="S" data-participant-2="LR"><polygon fill="#181818" points="870.2148,250.3672,880.2148,254.3672,870.2148,258.3672,874.2148,254.3672" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="575.6616" x2="876.2148" y1="254.3672" y2="254.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.6616" x="582.6616" y="249.1045">save(returnedDate = now)</text></g><path d="M20,269.3672 L80.1709,269.3672 L80.1709,278.6582 L70.1709,288.6582 L20,288.6582 L20,269.3672" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="353.4629" style="stroke:#000000;stroke-width:1.5;" width="1136.2275" x="20" y="269.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="35" y="284.3955">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="118.2661" x="95.1709" y="283.2373">[recommended != null]</text><g class="message" data-participant-1="S" data-participant-2="RR"><polygon fill="#181818" points="1032.9072,307.9492,1042.9072,311.9492,1032.9072,315.9492,1036.9072,311.9492" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="575.6616" x2="1038.9072" y1="311.9492" y2="311.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.5171" x="582.6616" y="306.6865">existsByLendingId(id)?</text></g><path d="M30,326.9492 L90.1709,326.9492 L90.1709,336.2402 L80.1709,346.2402 L30,346.2402 L30,326.9492" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="209.668" style="stroke:#000000;stroke-width:1.5;" width="1116.2275" x="30" y="326.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="45" y="341.9775">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="124.0991" x="105.1709" y="340.8193">[already recommended]</text><g class="message" data-participant-1="S" data-participant-2="C"><polygon fill="#181818" points="332.9082,365.5313,322.9082,369.5313,332.9082,373.5313,328.9082,369.5313" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="326.9082" x2="574.6616" y1="369.5313" y2="369.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163.3125" x="338.9082" y="364.2686">throws IllegalStateException</text></g><g class="message" data-participant-1="C" data-participant-2="Reader"><polygon fill="#181818" points="76.9585,414.1133,66.9585,418.1133,76.9585,422.1133,72.9585,418.1133" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="70.9585" x2="320.9082" y1="418.1133" y2="418.1133"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.6499" x="82.9585" y="395.5596">409 Conflict</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.1475" x="82.9585" y="412.8506">"recommendation already exists"</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="30" x2="1146.2275" y1="427.1133" y2="427.1133"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="121.6284" x="35" y="438.9834">[not yet recommended]</text><g class="message" data-participant-1="S" data-participant-2="RR"><polygon fill="#181818" points="1032.9072,462.0352,1042.9072,466.0352,1032.9072,470.0352,1036.9072,466.0352" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="575.6616" x2="1038.9072" y1="466.0352" y2="466.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.958" x="582.6616" y="460.7725">save(new Recommendation(...))</text></g><g class="message" data-participant-1="S" data-participant-2="C"><polygon fill="#181818" points="332.9082,493.3262,322.9082,497.3262,332.9082,501.3262,328.9082,497.3262" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="326.9082" x2="574.6616" y1="497.3262" y2="497.3262"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.709" x="338.9082" y="492.0635">LendingDTO</text></g><g class="message" data-participant-1="C" data-participant-2="Reader"><polygon fill="#181818" points="76.9585,524.6172,66.9585,528.6172,76.9585,532.6172,72.9585,528.6172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="70.9585" x2="320.9082" y1="528.6172" y2="528.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.6089" x="82.9585" y="523.3545">200 OK + LendingDTO</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="20" x2="1156.2275" y1="544.6172" y2="544.6172"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="112.4492" x="25" y="556.4873">[no recommendation]</text><g class="message" data-participant-1="S" data-participant-2="C"><polygon fill="#181818" points="332.9082,579.5391,322.9082,583.5391,332.9082,587.5391,328.9082,583.5391" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="326.9082" x2="574.6616" y1="583.5391" y2="583.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.709" x="338.9082" y="578.2764">LendingDTO</text></g><g class="message" data-participant-1="C" data-participant-2="Reader"><polygon fill="#181818" points="76.9585,610.8301,66.9585,614.8301,76.9585,618.8301,72.9585,614.8301" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="70.9585" x2="320.9082" y1="614.8301" y2="614.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.6089" x="82.9585" y="609.5674">200 OK + LendingDTO</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="1166.2275" y1="630.8301" y2="630.8301"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="219.3931" x="15" y="642.7002">[not found (already returned or invalid id)]</text><g class="message" data-participant-1="S" data-participant-2="C"><polygon fill="#181818" points="332.9082,665.752,322.9082,669.752,332.9082,673.752,328.9082,669.752" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="326.9082" x2="574.6616" y1="669.752" y2="669.752"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.3188" x="338.9082" y="664.4893">throws IllegalArgumentException</text></g><g class="message" data-participant-1="C" data-participant-2="Reader"><polygon fill="#181818" points="76.9585,697.043,66.9585,701.043,76.9585,705.043,72.9585,701.043" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="70.9585" x2="320.9082" y1="701.043" y2="701.043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.4644" x="82.9585" y="695.7803">400 Bad Request</text></g><!--SRC=[ZP91Rzim38Nl-XLS3aECTKamxBAYIT6aEmGBbaBkiHVDeZC1gkn9T59Zs7yV9Nk9qxN3hjB7nqS-ge8g3nALHYzgvSaKfbQEOBH1futRhIf7lh8M_GXKWDMBK8v-RmfCH2wq8lLD1Jn-IwohOBXHcuYD720IY-hnaJb5fdBFI2c5wBp1-mMiu1BkjlazJ5LjfhRJ3bEFr7Wt_MdqhmTtxV_eePwJRt1QAXlmRVT8yyba8bPHB6UnhdBPhlNOw0iOb5v0Nv29FD8RoNXfd8xmZTCoLQA-LOJhyBMnbXKoWAkhajVPr3mDBXP2MG9LaDaZz7QXh1gd1S19DgWzZlr04ERWgaF6KAmVk88t_CEz-ASNa540dqoWi6pxRQTfiki49GFMymhReL3wwoNYLkcxhmu1rXppJjcSsCJdfmBh64dFyj9YlowCI_Wu-mHy6gKr1JsuaJzByTYoSpPA4iWny5m4BT9hNkHn7muFS7uQOuukoqvqRxqV-lP- -xBH3xCPRB_0k-SWfXHwKt3kN_opnNyrYFB7YLFcC3u5qMKDV2h6xPKr6ZWnyMeWDtxNn6CSPl9N7ZDOAiqFFneC9BZ_Rm00]--></g></svg>