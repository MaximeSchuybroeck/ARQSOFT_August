<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="ACTIVITY" height="834px" preserveAspectRatio="none" style="width:817px;height:834px;background:#FFFFFF;" version="1.1" viewBox="0 0 817 834" width="817px" zoomAndPan="magnify"><defs/><g><ellipse cx="409.7712" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/><rect fill="#F1F1F1" height="51.9219" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="230.7617" x="294.3904" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="138.0703" x="304.3904" y="72.9492">POST /api/lendings/return</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="210.7617" x="304.3904" y="88.9102">(by id OR reader+book OR reader+title)</text><polygon fill="#F1F1F1" points="356.8767,121.9219,462.6658,121.9219,474.6658,133.9219,462.6658,145.9219,356.8767,145.9219,344.8767,133.9219,356.8767,121.9219" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="105.7891" x="356.8767" y="138.4766">Identify active lending</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="23.2354" x="321.6414" y="131.1611">by id</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="76.7476" x="474.6658" y="131.1611">by reader+book</text><rect fill="#F1F1F1" height="35.9609" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="234.1133" x="114.8015" y="155.9219"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="214.1133" x="124.8015" y="178.8711">repo.findByIdAndReturnedDateIsNull(id)</text><rect fill="#F1F1F1" height="35.9609" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="437.5391" x="368.9148" y="155.9219"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="417.5391" x="378.9148" y="178.8711">repo.findFirstByReaderEmailAndBookIdAndReturnedDateIsNull(email, bookId)</text><polygon fill="#F1F1F1" points="409.7712,197.8828,421.7712,209.8828,409.7712,221.8828,397.7712,209.8828,409.7712,197.8828" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="51.9219" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="241.3262" x="289.1082" y="291.1982"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="168.7559" x="299.1082" y="314.1475">throw IllegalArgumentException</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="221.3262" x="299.1082" y="330.1084">("Lending X not found / already returned")</text><ellipse cx="409.7712" cy="374.1201" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"/><ellipse cx="409.7712" cy="374.1201" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"/><polygon fill="#F1F1F1" points="382.8621,241.8828,436.6804,241.8828,448.6804,253.8828,436.6804,265.8828,382.8621,265.8828,370.8621,253.8828,382.8621,241.8828" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17.1177" x="413.7712" y="277.7529">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="53.8184" x="382.8621" y="258.4375">Not found?</text><rect fill="#F1F1F1" height="51.9219" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="159.0664" x="330.238" y="427.1201"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139.0664" x="340.238" y="450.0693">mark returnedDate = now;</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="99.3926" x="340.238" y="466.0303">repo.save(lending)</text><polygon fill="#F1F1F1" points="334.5652,499.042,484.9773,499.042,496.9773,511.042,484.9773,523.042,334.5652,523.042,322.5652,511.042,334.5652,499.042" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150.4121" x="334.5652" y="515.5967">recommended param present?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17.1177" x="305.4475" y="508.2813">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12.2354" x="496.9773" y="508.2813">no</text><polygon fill="#F1F1F1" points="138.9143,533.042,333.364,533.042,345.364,545.042,333.364,557.042,138.9143,557.042,126.9143,545.042,138.9143,533.042" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="194.4497" x="138.9143" y="549.5967">recRepo.existsByLendingId(lending.id)?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17.1177" x="109.7966" y="542.2813">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12.2354" x="345.364" y="542.2813">no</text><rect fill="#F1F1F1" height="51.9219" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="202.5898" x="11" y="567.042"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144.75" x="21" y="589.9912">throw IllegalStateException</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="182.5898" x="21" y="605.9521">("recommendation already exists")</text><ellipse cx="112.2949" cy="664.9639" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"/><ellipse cx="112.2949" cy="664.9639" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"/><rect fill="#F1F1F1" height="83.8438" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="252.7871" x="233.5898" y="567.042"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="124.0664" x="243.5898" y="589.9912">Build Recommendation</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="185.7246" x="243.5898" y="605.9521">(sentiment=POSITIVE/NEGATIVE,</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="232.7871" x="243.5898" y="621.9131">comment?, bookId, readerEmail, lendingId);</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="92.0332" x="243.5898" y="637.874">recRepo.save(...)</text><rect fill="#F1F1F1" height="35.9609" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="134.0527" x="516.377" y="533.042"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114.0527" x="526.377" y="555.9912">skip recommendation</text><polygon fill="#F1F1F1" points="409.7712,685.9639,421.7712,697.9639,409.7712,709.9639,397.7712,697.9639,409.7712,685.9639" style="stroke:#181818;stroke-width:0.5;"/><path d="M520.6511,719.9639 L520.6511,746.9004 L500.6511,750.9004 L520.6511,754.9004 L520.6511,781.8369 A0,0 0 0 0 520.6511,781.8369 L737.8445,781.8369 A0,0 0 0 0 737.8445,781.8369 L737.8445,729.9639 L727.8445,719.9639 L520.6511,719.9639 A0,0 0 0 0 520.6511,719.9639" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M727.8445,719.9639 L727.8445,729.9639 L737.8445,729.9639 L727.8445,719.9639" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.9263" x="526.6511" y="738.9922">Controller maps errors:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.1934" x="526.6511" y="756.2832">- IllegalArgumentException -&gt; 400</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173.7988" x="526.6511" y="773.5742">- IllegalStateException  -&gt; 409</text><rect fill="#F1F1F1" height="35.9609" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="181.7598" x="318.8914" y="732.9199"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="161.7598" x="328.8914" y="755.8691">Return 200 OK + LendingDTO</text><ellipse cx="409.7712" cy="812.8369" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"/><ellipse cx="409.7712" cy="812.8369" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="409.7712" x2="409.7712" y1="30" y2="50"/><polygon fill="#181818" points="405.7712,40,409.7712,50,413.7712,40,409.7712,44" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="344.8767" x2="231.8582" y1="133.9219" y2="133.9219"/><line style="stroke:#181818;stroke-width:1;" x1="231.8582" x2="231.8582" y1="133.9219" y2="155.9219"/><polygon fill="#181818" points="227.8582,145.9219,231.8582,155.9219,235.8582,145.9219,231.8582,149.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="474.6658" x2="587.6843" y1="133.9219" y2="133.9219"/><line style="stroke:#181818;stroke-width:1;" x1="587.6843" x2="587.6843" y1="133.9219" y2="155.9219"/><polygon fill="#181818" points="583.6843,145.9219,587.6843,155.9219,591.6843,145.9219,587.6843,149.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="231.8582" x2="231.8582" y1="191.8828" y2="209.8828"/><line style="stroke:#181818;stroke-width:1;" x1="231.8582" x2="397.7712" y1="209.8828" y2="209.8828"/><polygon fill="#181818" points="387.7712,205.8828,397.7712,209.8828,387.7712,213.8828,391.7712,209.8828" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="587.6843" x2="587.6843" y1="191.8828" y2="209.8828"/><line style="stroke:#181818;stroke-width:1;" x1="587.6843" x2="421.7712" y1="209.8828" y2="209.8828"/><polygon fill="#181818" points="431.7712,205.8828,421.7712,209.8828,431.7712,213.8828,427.7712,209.8828" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="409.7712" x2="409.7712" y1="101.9219" y2="121.9219"/><polygon fill="#181818" points="405.7712,111.9219,409.7712,121.9219,413.7712,111.9219,409.7712,115.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="409.7712" x2="409.7712" y1="343.1201" y2="363.1201"/><polygon fill="#181818" points="405.7712,353.1201,409.7712,363.1201,413.7712,353.1201,409.7712,357.1201" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="409.7712" x2="409.7712" y1="265.8828" y2="291.1982"/><polygon fill="#181818" points="405.7712,281.1982,409.7712,291.1982,413.7712,281.1982,409.7712,285.1982" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="448.6804" x2="540.4343" y1="253.8828" y2="253.8828"/><polygon fill="#181818" points="536.4343,332.6592,540.4343,342.6592,544.4343,332.6592,540.4343,336.6592" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="540.4343" x2="540.4343" y1="253.8828" y2="407.1201"/><line style="stroke:#181818;stroke-width:1;" x1="540.4343" x2="409.7712" y1="407.1201" y2="407.1201"/><line style="stroke:#181818;stroke-width:1;" x1="409.7712" x2="409.7712" y1="407.1201" y2="427.1201"/><polygon fill="#181818" points="405.7712,417.1201,409.7712,427.1201,413.7712,417.1201,409.7712,421.1201" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="409.7712" x2="409.7712" y1="221.8828" y2="241.8828"/><polygon fill="#181818" points="405.7712,231.8828,409.7712,241.8828,413.7712,231.8828,409.7712,235.8828" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="112.2949" x2="112.2949" y1="618.9639" y2="653.9639"/><polygon fill="#181818" points="108.2949,643.9639,112.2949,653.9639,116.2949,643.9639,112.2949,647.9639" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="126.9143" x2="112.2949" y1="545.042" y2="545.042"/><line style="stroke:#181818;stroke-width:1;" x1="112.2949" x2="112.2949" y1="545.042" y2="567.042"/><polygon fill="#181818" points="108.2949,557.042,112.2949,567.042,116.2949,557.042,112.2949,561.042" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="345.364" x2="359.9834" y1="545.042" y2="545.042"/><line style="stroke:#181818;stroke-width:1;" x1="359.9834" x2="359.9834" y1="545.042" y2="567.042"/><polygon fill="#181818" points="355.9834,557.042,359.9834,567.042,363.9834,557.042,359.9834,561.042" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="359.9834" x2="359.9834" y1="650.8857" y2="697.9639"/><line style="stroke:#181818;stroke-width:1;" x1="359.9834" x2="397.7712" y1="697.9639" y2="697.9639"/><polygon fill="#181818" points="387.7712,693.9639,397.7712,697.9639,387.7712,701.9639,391.7712,697.9639" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="322.5652" x2="236.1392" y1="511.042" y2="511.042"/><line style="stroke:#181818;stroke-width:1;" x1="236.1392" x2="236.1392" y1="511.042" y2="533.042"/><polygon fill="#181818" points="232.1392,523.042,236.1392,533.042,240.1392,523.042,236.1392,527.042" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="496.9773" x2="583.4033" y1="511.042" y2="511.042"/><line style="stroke:#181818;stroke-width:1;" x1="583.4033" x2="583.4033" y1="511.042" y2="533.042"/><polygon fill="#181818" points="579.4033,523.042,583.4033,533.042,587.4033,523.042,583.4033,527.042" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="583.4033" x2="583.4033" y1="569.0029" y2="697.9639"/><line style="stroke:#181818;stroke-width:1;" x1="583.4033" x2="421.7712" y1="697.9639" y2="697.9639"/><polygon fill="#181818" points="431.7712,693.9639,421.7712,697.9639,431.7712,701.9639,427.7712,697.9639" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="409.7712" x2="409.7712" y1="479.042" y2="499.042"/><polygon fill="#181818" points="405.7712,489.042,409.7712,499.042,413.7712,489.042,409.7712,493.042" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="409.7712" x2="409.7712" y1="709.9639" y2="732.9199"/><polygon fill="#181818" points="405.7712,722.9199,409.7712,732.9199,413.7712,722.9199,409.7712,726.9199" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="409.7712" x2="409.7712" y1="768.8809" y2="801.8369"/><polygon fill="#181818" points="405.7712,791.8369,409.7712,801.8369,413.7712,791.8369,409.7712,795.8369" style="stroke:#181818;stroke-width:1;"/><!--SRC=[TP9FR-8m4CNl-HIZda2b2LhjPOEw5TbcLr4hMAMewe6BmHEmSEp8Tjhcsw__92n1wYsEnsz-xyreGvI9qh_hbmqaf649Hq6PEEX4eMcLs8h9hWD6OLs2Ga9HtUwaF5qS3JCSfuk8LJ0fA0h3gWx8th1tX5vi2kQ80eBID0985JOohfYWMLVGfQ2bRuRqaHWizAhbV68h5n5oZVxTHU-nm6-cjCcwqj_dDM7SocMsx2jTT3KpsFaIry8YLf77Nqa3bMm5VHY8EzI-dJag-G45vtWWVAaERMsDvfzxR0oJBgIRvs0Lta0CAf00uGxSuGUE6ziGG1lP37tJcgZJ-TvnmhsL-5XiXVUeoJjEXXmNWLFXNjQMW2A5XYXIGwDGMw9hxhwuT4BuoRJHMTU35dHGZMtIrm-lBRyO2pRoUsOWxi_PQEWIRFP60S8KXUoLivPn2kL8m4ew0ypbUc-tiTWKhtcoolyitSTiAqAnUHWcD-jN8W_Zv8EhgGykMFRPnN7iQKBUboYfFh46naRE-v26rO5lypcid-0M-jmUDsix1JjZ1CKEHnFzai8eQMDIK9D60oebbKwZko_N1Uv-mlVv_7_5E5q8zpySYLicZ5oC_m00]--></g></svg>