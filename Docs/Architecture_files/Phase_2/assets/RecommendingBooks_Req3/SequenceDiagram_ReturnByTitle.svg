<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="871px" preserveAspectRatio="none" style="width:1526px;height:871px;background:#FFFFFF;" version="1.1" viewBox="0 0 1526 871" width="1526px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="497.2578" style="stroke:#000000;stroke-width:1.5;" width="1509.2271" x="10" y="274.3672"/><rect fill="none" height="336.1719" style="stroke:#000000;stroke-width:1.5;" width="1489.2271" x="20" y="331.9492"/><rect fill="none" height="192.377" style="stroke:#000000;stroke-width:1.5;" width="1469.2271" x="30" y="389.5313"/><g><title>Reader</title><rect fill="#000000" fill-opacity="0.00000" height="705.0039" width="8" x="61.9585" y="83.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="65" x2="65" y1="83.6211" y2="788.625"/></g><g><title>LendingController</title><rect fill="#000000" fill-opacity="0.00000" height="705.0039" width="8" x="360.9136" y="83.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="364.6553" x2="364.6553" y1="83.6211" y2="788.625"/></g><g><title>LendingService</title><rect fill="#000000" fill-opacity="0.00000" height="705.0039" width="8" x="731.7305" y="83.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="735.4756" x2="735.4756" y1="83.6211" y2="788.625"/></g><g><title>BookClient</title><rect fill="#000000" fill-opacity="0.00000" height="705.0039" width="8" x="890.1104" y="83.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="893.2588" x2="893.2588" y1="83.6211" y2="788.625"/></g><g><title>LendingRepository</title><rect fill="#000000" fill-opacity="0.00000" height="705.0039" width="8" x="1231.2144" y="83.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1234.8423" x2="1234.8423" y1="83.6211" y2="788.625"/></g><g><title>RecommendationRepository</title><rect fill="#000000" fill-opacity="0.00000" height="705.0039" width="8" x="1393.9067" y="83.6211"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1397.5864" x2="1397.5864" y1="83.6211" y2="788.625"/></g><g class="participant participant-head" data-participant="Reader"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.917" x="40" y="80.1074">Reader</text><ellipse cx="65.9585" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M65.9585,21.5 L65.9585,48.5 M52.9585,29.5 L78.9585,29.5 M65.9585,48.5 L52.9585,63.5 M65.9585,48.5 L78.9585,63.5" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Reader"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.917" x="40" y="802.7324">Reader</text><ellipse cx="65.9585" cy="814.7461" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M65.9585,822.7461 L65.9585,849.7461 M52.9585,830.7461 L78.9585,830.7461 M65.9585,849.7461 L52.9585,864.7461 M65.9585,849.7461 L78.9585,864.7461" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="C"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.5166" x="302.6553" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.5166" x="309.6553" y="72.1074">LendingController</text></g><g class="participant participant-tail" data-participant="C"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.5166" x="302.6553" y="787.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.5166" x="309.6553" y="809.7324">LendingController</text></g><g class="participant participant-head" data-participant="S"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110.5098" x="680.4756" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.5098" x="687.4756" y="72.1074">LendingService</text></g><g class="participant participant-tail" data-participant="S"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110.5098" x="680.4756" y="787.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.5098" x="687.4756" y="809.7324">LendingService</text></g><g class="participant participant-head" data-participant="BC"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81.7031" x="853.2588" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67.7031" x="860.2588" y="72.1074">BookClient</text></g><g class="participant participant-tail" data-participant="BC"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81.7031" x="853.2588" y="787.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67.7031" x="860.2588" y="809.7324">BookClient</text></g><g class="participant participant-head" data-participant="LR"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.7441" x="1173.8423" y="80.1074">LendingRepository</text><path d="M1217.2144,29 C1217.2144,19 1235.2144,19 1235.2144,19 C1235.2144,19 1253.2144,19 1253.2144,29 L1253.2144,55 C1253.2144,65 1235.2144,65 1235.2144,65 C1235.2144,65 1217.2144,65 1217.2144,55 L1217.2144,29" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1217.2144,29 C1217.2144,39 1235.2144,39 1235.2144,39 C1235.2144,39 1253.2144,39 1253.2144,29" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-tail" data-participant="LR"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.7441" x="1173.8423" y="802.7324">LendingRepository</text><path d="M1217.2144,816.2461 C1217.2144,806.2461 1235.2144,806.2461 1235.2144,806.2461 C1235.2144,806.2461 1253.2144,806.2461 1253.2144,816.2461 L1253.2144,842.2461 C1253.2144,852.2461 1235.2144,852.2461 1235.2144,852.2461 C1235.2144,852.2461 1217.2144,852.2461 1217.2144,842.2461 L1217.2144,816.2461" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1217.2144,816.2461 C1217.2144,826.2461 1235.2144,826.2461 1235.2144,826.2461 C1235.2144,826.2461 1253.2144,826.2461 1253.2144,816.2461" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-head" data-participant="RR"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176.6406" x="1306.5864" y="80.1074">RecommendationRepository</text><path d="M1379.9067,29 C1379.9067,19 1397.9067,19 1397.9067,19 C1397.9067,19 1415.9067,19 1415.9067,29 L1415.9067,55 C1415.9067,65 1397.9067,65 1397.9067,65 C1397.9067,65 1379.9067,65 1379.9067,55 L1379.9067,29" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1379.9067,29 C1379.9067,39 1397.9067,39 1397.9067,39 C1397.9067,39 1415.9067,39 1415.9067,29" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-tail" data-participant="RR"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176.6406" x="1306.5864" y="802.7324">RecommendationRepository</text><path d="M1379.9067,816.2461 C1379.9067,806.2461 1397.9067,806.2461 1397.9067,806.2461 C1397.9067,806.2461 1415.9067,806.2461 1415.9067,816.2461 L1415.9067,842.2461 C1415.9067,852.2461 1397.9067,852.2461 1397.9067,852.2461 C1397.9067,852.2461 1379.9067,852.2461 1379.9067,842.2461 L1379.9067,816.2461" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1379.9067,816.2461 C1379.9067,826.2461 1397.9067,826.2461 1397.9067,826.2461 C1397.9067,826.2461 1415.9067,826.2461 1415.9067,816.2461" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="message" data-participant-1="Reader" data-participant-2="C"><polygon fill="#181818" points="352.9136,130.2031,362.9136,134.2031,352.9136,138.2031,356.9136,134.2031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="65.9585" x2="358.9136" y1="134.2031" y2="134.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.4771" x="72.9585" y="111.6494">POST /api/lendings/return/by-title</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274.9551" x="72.9585" y="128.9404">?readerEmail=e&amp;bookTitle=t&amp;recommended=...</text></g><g class="message" data-participant-1="C" data-participant-2="S"><polygon fill="#181818" points="723.7305,161.4941,733.7305,165.4941,723.7305,169.4941,727.7305,165.4941" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="364.9136" x2="729.7305" y1="165.4941" y2="165.4941"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="346.8169" x="371.9136" y="160.2314">returnByReaderAndBookTitle(e, t, recommended, comment)</text></g><g class="message" data-participant-1="S" data-participant-2="BC"><polygon fill="#181818" points="882.1104,192.7852,892.1104,196.7852,882.1104,200.7852,886.1104,196.7852" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="735.7305" x2="888.1104" y1="196.7852" y2="196.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.3799" x="742.7305" y="191.5225">resolveBookIdByTitle(t)</text></g><g class="message" data-participant-1="BC" data-participant-2="S"><polygon fill="#181818" points="746.7305,224.0762,736.7305,228.0762,746.7305,232.0762,742.7305,228.0762" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="740.7305" x2="893.1104" y1="228.0762" y2="228.0762"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39.0317" x="752.7305" y="222.8135">bookId</text></g><g class="message" data-participant-1="S" data-participant-2="LR"><polygon fill="#181818" points="1223.2144,255.3672,1233.2144,259.3672,1223.2144,263.3672,1227.2144,259.3672" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="735.7305" x2="1229.2144" y1="259.3672" y2="259.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="475.4839" x="742.7305" y="254.1045">findFirstByReaderEmailAndBookIdAndReturnedDateIsNull(e, bookId) &#171;for update&#187;</text></g><path d="M10,274.3672 L70.1709,274.3672 L70.1709,283.6582 L60.1709,293.6582 L10,293.6582 L10,274.3672" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="497.2578" style="stroke:#000000;stroke-width:1.5;" width="1509.2271" x="10" y="274.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="25" y="289.3955">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="114.2754" x="85.1709" y="288.2373">[active lending found]</text><g class="message" data-participant-1="S" data-participant-2="LR"><polygon fill="#181818" points="1223.2144,312.9492,1233.2144,316.9492,1223.2144,320.9492,1227.2144,316.9492" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="735.7305" x2="1229.2144" y1="316.9492" y2="316.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.6616" x="742.7305" y="311.6865">save(returnedDate = now)</text></g><path d="M20,331.9492 L80.1709,331.9492 L80.1709,341.2402 L70.1709,351.2402 L20,351.2402 L20,331.9492" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="336.1719" style="stroke:#000000;stroke-width:1.5;" width="1489.2271" x="20" y="331.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="35" y="346.9775">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="125.3076" x="95.1709" y="345.8193">[recommended present]</text><g class="message" data-participant-1="S" data-participant-2="RR"><polygon fill="#181818" points="1385.9067,370.5313,1395.9067,374.5313,1385.9067,378.5313,1389.9067,374.5313" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="735.7305" x2="1391.9067" y1="374.5313" y2="374.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.0552" x="742.7305" y="369.2686">existsByLendingId(lending.id)?</text></g><path d="M30,389.5313 L90.1709,389.5313 L90.1709,398.8223 L80.1709,408.8223 L30,408.8223 L30,389.5313" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="192.377" style="stroke:#000000;stroke-width:1.5;" width="1469.2271" x="30" y="389.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="45" y="404.5596">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="75.1846" x="105.1709" y="403.4014">[duplicate rec]</text><g class="message" data-participant-1="S" data-participant-2="C"><polygon fill="#181818" points="375.9136,428.1133,365.9136,432.1133,375.9136,436.1133,371.9136,432.1133" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="369.9136" x2="734.7305" y1="432.1133" y2="432.1133"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163.3125" x="381.9136" y="426.8506">throws IllegalStateException</text></g><g class="message" data-participant-1="C" data-participant-2="Reader"><polygon fill="#181818" points="76.9585,459.4043,66.9585,463.4043,76.9585,467.4043,72.9585,463.4043" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="70.9585" x2="363.9136" y1="463.4043" y2="463.4043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.6499" x="82.9585" y="458.1416">409 Conflict</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="30" x2="1499.2271" y1="472.4043" y2="472.4043"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="20.1631" x="35" y="484.2744">[ok]</text><g class="message" data-participant-1="S" data-participant-2="RR"><polygon fill="#181818" points="1385.9067,507.3262,1395.9067,511.3262,1385.9067,515.3262,1389.9067,511.3262" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="735.7305" x2="1391.9067" y1="511.3262" y2="511.3262"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.0044" x="742.7305" y="506.0635">save(Recommendation)</text></g><g class="message" data-participant-1="S" data-participant-2="C"><polygon fill="#181818" points="375.9136,538.6172,365.9136,542.6172,375.9136,546.6172,371.9136,542.6172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="369.9136" x2="734.7305" y1="542.6172" y2="542.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.709" x="381.9136" y="537.3545">LendingDTO</text></g><g class="message" data-participant-1="C" data-participant-2="Reader"><polygon fill="#181818" points="76.9585,569.9082,66.9585,573.9082,76.9585,577.9082,72.9585,573.9082" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="70.9585" x2="363.9136" y1="573.9082" y2="573.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44.0845" x="82.9585" y="568.6455">200 OK</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="20" x2="1509.2271" y1="589.9082" y2="589.9082"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="67.2192" x="25" y="601.7783">[not present]</text><g class="message" data-participant-1="S" data-participant-2="C"><polygon fill="#181818" points="375.9136,624.8301,365.9136,628.8301,375.9136,632.8301,371.9136,628.8301" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="369.9136" x2="734.7305" y1="628.8301" y2="628.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.709" x="381.9136" y="623.5674">LendingDTO</text></g><g class="message" data-participant-1="C" data-participant-2="Reader"><polygon fill="#181818" points="76.9585,656.1211,66.9585,660.1211,76.9585,664.1211,72.9585,660.1211" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="70.9585" x2="363.9136" y1="660.1211" y2="660.1211"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44.0845" x="82.9585" y="654.8584">200 OK</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="1519.2271" y1="676.1211" y2="676.1211"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="58.0239" x="15" y="687.9912">[not found]</text><g class="message" data-participant-1="S" data-participant-2="C"><polygon fill="#181818" points="375.9136,711.043,365.9136,715.043,375.9136,719.043,371.9136,715.043" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="369.9136" x2="734.7305" y1="715.043" y2="715.043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.3188" x="381.9136" y="709.7803">throws IllegalArgumentException</text></g><g class="message" data-participant-1="C" data-participant-2="Reader"><polygon fill="#181818" points="76.9585,759.625,66.9585,763.625,76.9585,767.625,72.9585,763.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="70.9585" x2="363.9136" y1="763.625" y2="763.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.4644" x="82.9585" y="741.0713">400 Bad Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.9365" x="82.9585" y="758.3623">"Could not resolve lending"</text></g><!--SRC=[TP9DR-8m48Rl-HKZ3XL8V6crbwqALPDs9RHeMIKSUp7nm5erTjQUqFBlrr_GqD9J8iyxppj-FQmcRQ14nj5a3JCaQj4mHT1Rek92xGgjo6WfqVI0MIYkYYeq1r5ZK5INYbphbq8AL1IgUP5nHcp3B9wxIsoq5MwEOv0iouwan5hlzqx7I6ZrGLcMMHP7Xz4S2hY5Fwjg3HFMY8cCR3inIArHayrnH88aFgjx4rgUzap86Tvit81hNvdHZJcv8P-Dn-EiyDpASICaFqQt1yNpKrSVXq13w7GE8VxI8AjyVru4WDNoWBvjmVDZR7KALnmbZqsenPvbwGwsGl6VmbWw-OQHa_c2kvyoZ8NyaH4kxEzMIZzE10tWxcxhthPjN7OudsTC4h2Qn04XXGDRtIgU0RnxMdR0lkbWOGPAlmwSoFTthWcDkvExfQiaGEa1-2OisVoOtdR1-ybiBFZWFeWzYBUD5BNdEsGuJH0V5lqr-jN2mctTZicAdEpfhSR6hq3InjZIuz_2z-aFS9kwTSmu44gtFVgbIoxFzxjSgi6xAFcdsH_Ng-jktwPJMFsAFY6_uAOqVSpaEkyhccUTIHTFypcK1xDh_OvrS_cKoHHonjt1lnOjFQjUeLl90psjusaHUfdx_WS0]--></g></svg>