<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="900px" preserveAspectRatio="none" style="width:1270px;height:900px;background:#FFFFFF;" version="1.1" viewBox="0 0 1270 900" width="1270.4px" zoomAndPan="magnify"><title>Borrow flow - Command -&gt; Event -&gt; Read Model</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="11.2" font-weight="bold" lengthAdjust="spacing" textLength="255.757" x="504.45" y="24.0859">Borrow flow - Command -&gt; Event -&gt; Read Model</text><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="718.4172" width="6.4" x="15.0234" y="102.2906"/><line style="stroke:#181818;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="17.6" x2="17.6" y1="102.2906" y2="820.7078"/></g><g><title>Client UI</title><rect fill="#000000" fill-opacity="0.00000" height="718.4172" width="6.4" x="99.9699" y="102.2906"/><line style="stroke:#181818;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="102.4969" x2="102.4969" y1="102.2906" y2="820.7078"/></g><g><title>Gateway</title><rect fill="#000000" fill-opacity="0.00000" height="718.4172" width="6.4" x="271.1734" y="102.2906"/><line style="stroke:#181818;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="273.8742" x2="273.8742" y1="102.2906" y2="820.7078"/></g><g><title>Lending Service</title><rect fill="#000000" fill-opacity="0.00000" height="718.4172" width="6.4" x="399.0809" y="102.2906"/><line style="stroke:#181818;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="402.1211" x2="402.1211" y1="102.2906" y2="820.7078"/></g><g><title>Book Service</title><rect fill="#000000" fill-opacity="0.00000" height="718.4172" width="6.4" x="507.8895" y="102.2906"/><line style="stroke:#181818;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="510.8965" x2="510.8965" y1="102.2906" y2="820.7078"/></g><g><title>Reader Service</title><rect fill="#000000" fill-opacity="0.00000" height="718.4172" width="6.4" x="598.6781" y="102.2906"/><line style="stroke:#181818;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="601.6824" x2="601.6824" y1="102.2906" y2="820.7078"/></g><g><title>RabbitMQ</title><rect fill="#000000" fill-opacity="0.00000" height="718.4172" width="6.4" x="702.777" y="102.2906"/><line style="stroke:#181818;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="705.2738" x2="705.2738" y1="102.2906" y2="820.7078"/></g><g><title>Reporting Service</title><rect fill="#000000" fill-opacity="0.00000" height="718.4172" width="6.4" x="934.1563" y="102.2906"/><line style="stroke:#181818;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="936.8461" x2="936.8461" y1="102.2906" y2="820.7078"/></g><g><title>Postgres</title><rect fill="#000000" fill-opacity="0.00000" height="718.4172" width="6.4" x="1054.7434" y="102.2906"/><line style="stroke:#181818;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="1057.8664" x2="1057.8664" y1="102.2906" y2="820.7078"/></g><g><title>Postgres</title><rect fill="#000000" fill-opacity="0.00000" height="718.4172" width="6.4" x="1191.7387" y="102.2906"/><line style="stroke:#181818;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="1194.8203" x2="1194.8203" y1="102.2906" y2="820.7078"/></g><g class="participant participant-head" data-participant="user"><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="23.6469" x="4" y="99.4797">User</text><ellipse cx="18.2234" cy="46.1938" fill="#E2E2F0" rx="6.4" ry="6.4" style="stroke:#181818;stroke-width:0.4;"/><path d="M18.2234,52.5938 L18.2234,74.1938 M7.8234,58.9938 L28.6234,58.9938 M18.2234,74.1938 L7.8234,86.1938 M18.2234,74.1938 L28.6234,86.1938" fill="none" style="stroke:#181818;stroke-width:0.4;"/></g><g class="participant participant-tail" data-participant="user"><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="23.6469" x="4" y="831.9938">User</text><ellipse cx="18.2234" cy="841.6047" fill="#E2E2F0" rx="6.4" ry="6.4" style="stroke:#181818;stroke-width:0.4;"/><path d="M18.2234,848.0047 L18.2234,869.6047 M7.8234,854.4047 L28.6234,854.4047 M18.2234,869.6047 L7.8234,881.6047 M18.2234,869.6047 L28.6234,881.6047" fill="none" style="stroke:#181818;stroke-width:0.4;"/></g><g class="participant participant-head" data-participant="client"><rect fill="#E2E2F0" height="26.0969" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4;" width="54.1461" x="76.0969" y="75.3938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="42.9461" x="81.6969" y="93.0797">Client UI</text></g><g class="participant participant-tail" data-participant="client"><rect fill="#E2E2F0" height="26.0969" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4;" width="54.1461" x="76.0969" y="819.9078"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="42.9461" x="81.6969" y="837.5938">Client UI</text></g><g class="participant participant-head" data-participant="gw"><rect fill="#E2E2F0" height="26.0969" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4;" width="55.3984" x="246.6742" y="75.3938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="44.1984" x="252.2742" y="93.0797">Gateway</text></g><g class="participant participant-tail" data-participant="gw"><rect fill="#E2E2F0" height="26.0969" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4;" width="55.3984" x="246.6742" y="819.9078"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="44.1984" x="252.2742" y="837.5938">Gateway</text></g><g class="participant participant-head" data-participant="lending"><rect fill="#E2E2F0" height="26.0969" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4;" width="91.5195" x="356.5211" y="75.3938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="80.3195" x="362.1211" y="93.0797">Lending Service</text></g><g class="participant participant-tail" data-participant="lending"><rect fill="#E2E2F0" height="26.0969" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4;" width="91.5195" x="356.5211" y="819.9078"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="80.3195" x="362.1211" y="837.5938">Lending Service</text></g><g class="participant participant-head" data-participant="book"><rect fill="#E2E2F0" height="26.0969" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4;" width="77.1859" x="472.4965" y="75.3938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="65.9859" x="478.0965" y="93.0797">Book Service</text></g><g class="participant participant-tail" data-participant="book"><rect fill="#E2E2F0" height="26.0969" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4;" width="77.1859" x="472.4965" y="819.9078"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="65.9859" x="478.0965" y="837.5938">Book Service</text></g><g class="participant participant-head" data-participant="reader"><rect fill="#E2E2F0" height="26.0969" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4;" width="88.3914" x="557.6824" y="75.3938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="77.1914" x="563.2824" y="93.0797">Reader Service</text></g><g class="participant participant-tail" data-participant="reader"><rect fill="#E2E2F0" height="26.0969" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4;" width="88.3914" x="557.6824" y="819.9078"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="77.1914" x="563.2824" y="837.5938">Reader Service</text></g><g class="participant participant-head" data-participant="mq"><path d="M658.0738,64.4969 L753.8801,64.4969 C757.8801,64.4969 757.8801,83.3938 757.8801,83.3938 C757.8801,83.3938 757.8801,102.2906 753.8801,102.2906 L658.0738,102.2906 C654.0738,102.2906 654.0738,83.3938 654.0738,83.3938 C654.0738,83.3938 654.0738,64.4969 658.0738,64.4969" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.4;"/><path d="M753.8801,64.4969 C749.8801,64.4969 749.8801,83.3938 749.8801,83.3938 C749.8801,102.2906 753.8801,102.2906 753.8801,102.2906" fill="none" style="stroke:#181818;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="50.4164" x="676.7688" y="80.5828">RabbitMQ</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="87.8063" x="658.0738" y="95.4797">lending.exchange</text></g><g class="participant participant-tail" data-participant="mq"><path d="M658.0738,819.9078 L753.8801,819.9078 C757.8801,819.9078 757.8801,838.8047 757.8801,838.8047 C757.8801,838.8047 757.8801,857.7016 753.8801,857.7016 L658.0738,857.7016 C654.0738,857.7016 654.0738,838.8047 654.0738,838.8047 C654.0738,838.8047 654.0738,819.9078 658.0738,819.9078" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.4;"/><path d="M753.8801,819.9078 C749.8801,819.9078 749.8801,838.8047 749.8801,838.8047 C749.8801,857.7016 753.8801,857.7016 753.8801,857.7016" fill="none" style="stroke:#181818;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="50.4164" x="676.7688" y="835.9938">RabbitMQ</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="87.8063" x="658.0738" y="850.8906">lending.exchange</text></g><g class="participant participant-head" data-participant="reporting"><rect fill="#E2E2F0" height="26.0969" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4;" width="100.2203" x="887.2461" y="75.3938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="89.0203" x="892.8461" y="93.0797">Reporting Service</text></g><g class="participant participant-tail" data-participant="reporting"><rect fill="#E2E2F0" height="26.0969" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4;" width="100.2203" x="887.2461" y="819.9078"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="89.0203" x="892.8461" y="837.5938">Reporting Service</text></g><g class="participant participant-head" data-participant="db_cmd"><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="44.1984" x="1033.4441" y="84.5828">Postgres</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="120.1539" x="995.4664" y="99.4797">lending_service schema</text><path d="M1043.5434,43.6969 C1043.5434,35.6969 1057.9434,35.6969 1057.9434,35.6969 C1057.9434,35.6969 1072.3434,35.6969 1072.3434,43.6969 L1072.3434,64.4969 C1072.3434,72.4969 1057.9434,72.4969 1057.9434,72.4969 C1057.9434,72.4969 1043.5434,72.4969 1043.5434,64.4969 L1043.5434,43.6969" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.2;"/><path d="M1043.5434,43.6969 C1043.5434,51.6969 1057.9434,51.6969 1057.9434,51.6969 C1057.9434,51.6969 1072.3434,51.6969 1072.3434,43.6969" fill="none" style="stroke:#181818;stroke-width:1.2;"/></g><g class="participant participant-tail" data-participant="db_cmd"><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="44.1984" x="1033.4441" y="831.9938">Postgres</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="120.1539" x="995.4664" y="846.8906">lending_service schema</text><path d="M1043.5434,857.7016 C1043.5434,849.7016 1057.9434,849.7016 1057.9434,849.7016 C1057.9434,849.7016 1072.3434,849.7016 1072.3434,857.7016 L1072.3434,878.5016 C1072.3434,886.5016 1057.9434,886.5016 1057.9434,886.5016 C1057.9434,886.5016 1043.5434,886.5016 1043.5434,878.5016 L1043.5434,857.7016" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.2;"/><path d="M1043.5434,857.7016 C1043.5434,865.7016 1057.9434,865.7016 1057.9434,865.7016 C1057.9434,865.7016 1072.3434,865.7016 1072.3434,857.7016" fill="none" style="stroke:#181818;stroke-width:1.2;"/></g><g class="participant participant-head" data-participant="db_query"><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="44.1984" x="1170.4395" y="84.5828">Postgres</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="128.2367" x="1128.4203" y="99.4797">reporting_service schema</text><path d="M1180.5387,43.6969 C1180.5387,35.6969 1194.9387,35.6969 1194.9387,35.6969 C1194.9387,35.6969 1209.3387,35.6969 1209.3387,43.6969 L1209.3387,64.4969 C1209.3387,72.4969 1194.9387,72.4969 1194.9387,72.4969 C1194.9387,72.4969 1180.5387,72.4969 1180.5387,64.4969 L1180.5387,43.6969" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.2;"/><path d="M1180.5387,43.6969 C1180.5387,51.6969 1194.9387,51.6969 1194.9387,51.6969 C1194.9387,51.6969 1209.3387,51.6969 1209.3387,43.6969" fill="none" style="stroke:#181818;stroke-width:1.2;"/></g><g class="participant participant-tail" data-participant="db_query"><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="44.1984" x="1170.4395" y="831.9938">Postgres</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="128.2367" x="1128.4203" y="846.8906">reporting_service schema</text><path d="M1180.5387,857.7016 C1180.5387,849.7016 1194.9387,849.7016 1194.9387,849.7016 C1194.9387,849.7016 1209.3387,849.7016 1209.3387,857.7016 L1209.3387,878.5016 C1209.3387,886.5016 1194.9387,886.5016 1194.9387,886.5016 C1194.9387,886.5016 1180.5387,886.5016 1180.5387,878.5016 L1180.5387,857.7016" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.2;"/><path d="M1180.5387,857.7016 C1180.5387,865.7016 1194.9387,865.7016 1194.9387,865.7016 C1194.9387,865.7016 1209.3387,865.7016 1209.3387,857.7016" fill="none" style="stroke:#181818;stroke-width:1.2;"/></g><g class="message" data-participant-1="user" data-participant-2="client"><polygon fill="#181818" points="93.5699,125.7234,101.5699,128.9234,93.5699,132.1234,96.7699,128.9234" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;" x1="18.2234" x2="98.3699" y1="128.9234" y2="128.9234"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="65.7465" x="27.8234" y="124.7133">Click "Borrow"</text></g><g class="message" data-participant-1="client" data-participant-2="gw"><polygon fill="#181818" points="264.7734,164.5891,272.7734,167.7891,264.7734,170.9891,267.9734,167.7891" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;" x1="103.1699" x2="269.5734" y1="167.7891" y2="167.7891"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="124.282" x="126.6307" y="149.7461">POST /api/lendings/borrow</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="152.0035" x="112.7699" y="163.5789">bookId, readerEmail, days (JWT)</text></g><g class="message" data-participant-1="gw" data-participant-2="lending"><polygon fill="#181818" points="392.6809,189.6219,400.6809,192.8219,392.6809,196.0219,395.8809,192.8219" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;" x1="274.3734" x2="397.4809" y1="192.8219" y2="192.8219"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="75.7199" x="300.4672" y="188.6117">Forward request</text></g><rect fill="#EEEEEE" height="2.4" style="stroke:#EEEEEE;stroke-width:0.8;" width="1265.457" x="0" y="216.5383"/><line style="stroke:#000000;stroke-width:0.8;" x1="0" x2="1265.457" y1="216.5383" y2="216.5383"/><line style="stroke:#000000;stroke-width:0.8;" x1="0" x2="1265.457" y1="218.9383" y2="218.9383"/><rect fill="#EEEEEE" height="20.2328" style="stroke:#000000;stroke-width:1.6;" width="101.3672" x="582.0449" y="207.2219"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="87.2777" x="586.8449" y="221.6445">Validate &amp; persist</text><g class="message" data-participant-1="lending" data-participant-2="book"><polygon fill="#181818" points="501.4895,264.7203,509.4895,267.9203,501.4895,271.1203,504.6895,267.9203" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;" x1="402.2809" x2="506.2895" y1="267.9203" y2="267.9203"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="89.6086" x="411.8809" y="249.8773">GET /api/books/{id}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="83.2355" x="415.0674" y="263.7102">(exists/available?)</text></g><g class="message" data-participant-1="book" data-participant-2="lending"><polygon fill="#181818" points="411.0809,289.7531,403.0809,292.9531,411.0809,296.1531,407.8809,292.9531" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;stroke-dasharray:2.0,2.0;" x1="406.2809" x2="510.2895" y1="292.9531" y2="292.9531"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="35.2676" x="439.0514" y="288.743">200 OK</text></g><g class="message" data-participant-1="lending" data-participant-2="reader"><polygon fill="#181818" points="592.2781,328.6188,600.2781,331.8188,592.2781,335.0188,595.4781,331.8188" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;" x1="402.2809" x2="597.0781" y1="331.8188" y2="331.8188"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="113.877" x="445.141" y="313.7758">GET /api/readers/{email}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="39.2945" x="482.4322" y="327.6086">(exists?)</text></g><g class="message" data-participant-1="reader" data-participant-2="lending"><polygon fill="#181818" points="411.0809,353.6516,403.0809,356.8516,411.0809,360.0516,407.8809,356.8516" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;stroke-dasharray:2.0,2.0;" x1="406.2809" x2="601.0781" y1="356.8516" y2="356.8516"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="35.2676" x="484.4457" y="352.6414">200 OK</text></g><g class="message" data-participant-1="lending" data-participant-2="db_cmd"><polygon fill="#181818" points="1048.3434,392.5172,1056.3434,395.7172,1048.3434,398.9172,1051.5434,395.7172" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;" x1="402.2809" x2="1053.1434" y1="395.7172" y2="395.7172"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="78.0406" x="691.0918" y="377.6742">INSERT Lending</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="108.6668" x="675.7787" y="391.507">(startDate, dueDate, ...)</text></g><g class="message" data-participant-1="db_cmd" data-participant-2="lending"><polygon fill="#181818" points="411.0809,417.55,403.0809,420.75,411.0809,423.95,407.8809,420.75" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;stroke-dasharray:2.0,2.0;" x1="406.2809" x2="1057.1434" y1="420.75" y2="420.75"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="15.0262" x="722.599" y="416.5398">OK</text></g><rect fill="#EEEEEE" height="2.4" style="stroke:#EEEEEE;stroke-width:0.8;" width="1265.457" x="0" y="444.4664"/><line style="stroke:#000000;stroke-width:0.8;" x1="0" x2="1265.457" y1="444.4664" y2="444.4664"/><line style="stroke:#000000;stroke-width:0.8;" x1="0" x2="1265.457" y1="446.8664" y2="446.8664"/><rect fill="#EEEEEE" height="20.2328" style="stroke:#000000;stroke-width:1.6;" width="121.573" x="571.942" y="435.15"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="107.4836" x="576.742" y="449.5727">Publish domain event</text><g class="message" data-participant-1="lending" data-participant-2="mq"><polygon fill="#181818" points="696.377,534.1469,704.377,537.3469,696.377,540.5469,699.577,537.3469" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;" x1="402.2809" x2="701.177" y1="537.3469" y2="537.3469"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="80.9453" x="513.6563" y="477.8055">Publish BookLent</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="138.7699" x="484.7439" y="491.6383">(exchange: lending.exchange,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="137.602" x="485.3279" y="505.4711">routingKey: lending.book-lent,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="141.6441" x="483.3068" y="519.3039">payload: {bookId, readerEmail,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="188.4594" x="459.8992" y="533.1367">authorId, authorName, genre, startDate})</text></g><rect fill="#EEEEEE" height="2.4" style="stroke:#EEEEEE;stroke-width:0.8;" width="1265.457" x="0" y="561.0633"/><line style="stroke:#000000;stroke-width:0.8;" x1="0" x2="1265.457" y1="561.0633" y2="561.0633"/><line style="stroke:#000000;stroke-width:0.8;" x1="0" x2="1265.457" y1="563.4633" y2="563.4633"/><rect fill="#EEEEEE" height="20.2328" style="stroke:#000000;stroke-width:1.6;" width="135.4414" x="565.0078" y="551.7469"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="121.352" x="569.8078" y="566.1695">Async projection update</text><g class="message" data-participant-1="mq" data-participant-2="reporting"><polygon fill="#181818" points="927.7563,595.4125,935.7563,598.6125,927.7563,601.8125,930.9563,598.6125" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;" x1="705.977" x2="932.5563" y1="598.6125" y2="598.6125"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="212.1793" x="715.577" y="594.4023">Deliver BookLent to reporting.book-lent.queue</text></g><g class="message" data-participant-1="reporting" data-participant-2="db_query"><polygon fill="#181818" points="1185.3387,620.4453,1193.3387,623.6453,1185.3387,626.8453,1188.5387,623.6453" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;" x1="937.3563" x2="1190.1387" y1="623.6453" y2="623.6453"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="198.8492" x="966.7229" y="619.4352">UPSERT LendingStats, AuthorBorrowStats</text></g><g class="message" data-participant-1="db_query" data-participant-2="reporting"><polygon fill="#181818" points="946.1563,645.4781,938.1563,648.6781,946.1563,651.8781,942.9563,648.6781" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;stroke-dasharray:2.0,2.0;" x1="941.3563" x2="1194.1387" y1="648.6781" y2="648.6781"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="15.0262" x="1058.6344" y="644.468">OK</text></g><rect fill="#EEEEEE" height="2.4" style="stroke:#EEEEEE;stroke-width:0.8;" width="1265.457" x="0" y="672.3945"/><line style="stroke:#000000;stroke-width:0.8;" x1="0" x2="1265.457" y1="672.3945" y2="672.3945"/><line style="stroke:#000000;stroke-width:0.8;" x1="0" x2="1265.457" y1="674.7945" y2="674.7945"/><rect fill="#EEEEEE" height="20.2328" style="stroke:#000000;stroke-width:1.6;" width="106.5672" x="579.4449" y="663.0781"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="92.4777" x="584.2449" y="677.5008">Response to caller</text><g class="message" data-participant-1="lending" data-participant-2="gw"><polygon fill="#181818" points="283.1734,720.5766,275.1734,723.7766,283.1734,726.9766,279.9734,723.7766" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;stroke-dasharray:2.0,2.0;" x1="278.3734" x2="401.4809" y1="723.7766" y2="723.7766"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="57.2406" x="309.7068" y="705.7336">201 Created</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="108.7074" x="283.9734" y="719.5664">{lendingId, dueDate, ...}</text></g><g class="message" data-participant-1="gw" data-participant-2="client"><polygon fill="#181818" points="111.9699,745.6094,103.9699,748.8094,111.9699,752.0094,108.7699,748.8094" style="stroke:#181818;stroke-width:0.8;"/><line style="stroke:#181818;stroke-width:0.8;stroke-dasharray:2.0,2.0;" x1="107.1699" x2="273.5734" y1="748.8094" y2="748.8094"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="57.2406" x="160.1514" y="744.5992">201 Created</text></g><path d="M880.8,759.2094 L880.8,808.0094 L1250.4,808.0094 L1250.4,767.2094 L1242.4,759.2094 L880.8,759.2094" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4;"/><path d="M1242.4,759.2094 L1242.4,767.2094 L1250.4,767.2094 L1242.4,759.2094" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="185.0012" x="945.2293" y="774.432">Read model is updated asynchronously.</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="204.0594" x="945.2293" y="788.2648">Clients may not immediately see the change</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="234.1523" x="945.2293" y="802.0977">in reporting endpoints due to eventual consistency.</text><!--SRC=[XLNRJXin47ttLuoeL86K2-KHYLRXKaGfXN9fNoAXsVMmSV7QY-qbh13_th5tasmYgkOXsVMSEJvpFEC45JJ1eNNEpk51yzSGZcnPef4m_0mdpsH2VBWcb71X9MaX_ACo5Jei8SFyiN2sDlB8QklWmqFwz12UdceoELsGzrZGHAl2GCwav7eeHxwonYzGXyH29abIS3NrwMOexLoP0XvGUn82yy3xtdboW1vg_XMC32fN5RBohIEjOWLtPrindgUtTSGf1ffZa-B5V3tsdOoCczsGUrOv9OnkrzQ1XzO-hg4oNbY7H0TPPH_aqf9WXsfY06QP2XS_fwRROaGl-GnDqOBBfqs-olBhXZgtM1KI0sRecVZA-b2mnKlYUzzcWCzdL69AbDbzNiftivQS_yXZ_QuH8feVMwKr6VQ1lSyVepVn9BT4jyw8OixHgykRMnXZfSQTAZ_E4d9gedbdSj3vSrAYqWEGs7ZO_lRxTaTmFhDqQKprrRevEibubkA340S7y0kruc88Fa95pYiVuE10B78uFMx2kQSddOhuxiUlIhvDpJQzS88VupDlZPccBpiYuOTh- -xjxiBbUP-qLTodRLUOc68PAsvcxC3_usnFXaDdFsvEhc-XQqfcye4RufYBP7TgQXz6ez6Ew5BMcPar6dDLPrhv6KZBWWnGcl1rQygdU3uTBhOsRncIyhOVzs6pGmVS9RQEFN9EpIeSFHloI-1uXOssAFVXzRtZdHgimyowkDu-_S2Iooc8ssy0oqhVTb8H4z-O72fd_r0Ub3LGL-cmkGuMdmvYCHtxS4nQFRFHYqeWs5LyfN6Kvb2iCbllKtSpozrLt_sRWC4FO9AajXsUbiGoOxYXehF_khlgeeWSjMPTVVCNqx6t-mcEsA10ScfUkt0qft_GRsaI-YFNInF2M7R4nigNEWQhUKqtUXblT52-yq_oHBEnCsUDhRrkHgAzF_dsmGQO3rHPabGCrGtVxLp5ZA1j0S7DjAgN1LTMnKmM76jDVLQZXfohvm7WFmMcPrYa9V4N]--></g></svg>