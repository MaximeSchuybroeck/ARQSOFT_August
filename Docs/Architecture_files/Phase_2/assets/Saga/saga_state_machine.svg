<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="STATE" height="875.2px" preserveAspectRatio="none" style="width:832px;height:875px;background:#FFFFFF;" version="1.1" viewBox="0 0 832 875" width="832px" zoomAndPan="magnify"><title>Orchestrated Saga - State Machine (Borrow with Reservation)</title><defs/><g><g class="title" data-source-line="1"><text fill="#000000" font-family="sans-serif" font-size="11.2" font-weight="bold" lengthAdjust="spacing" textLength="327.3648" x="247.0539" y="20.0859">Orchestrated Saga - State Machine (Borrow with Reservation)</text></g><path d="M322.4,438.8969 L448.0547,438.8969 A4,4 0 0 1 452.0547,442.8969 L452.0547,461.7938 L318.4,461.7938 L318.4,442.8969 A4,4 0 0 1 322.4,438.8969" fill="#F1F1F1"/><rect fill="none" height="239.6969" rx="4" ry="4" style="stroke:#181818;stroke-width:0.4;" width="133.6547" x="318.4" y="438.8969"/><line style="stroke:#181818;stroke-width:0.4;" x1="318.4" x2="452.0547" y1="461.7938" y2="461.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="72.2203" x="349.1172" y="454.9828">Compensating</text><ellipse cx="386.4" cy="478.5938" fill="#222222" rx="8" ry="8" style="stroke:#222222;stroke-width:0.8;"/><g id="Compensating.CancelLending"><rect fill="#F1F1F1" height="40" rx="4" ry="4" style="stroke:#181818;stroke-width:0.4;" width="90.725" x="341.2" y="515.3938"/><line style="stroke:#181818;stroke-width:0.4;" x1="341.2" x2="431.925" y1="538.2906" y2="538.2906"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="74.725" x="349.2" y="531.4797">CancelLending</text></g><g id="Compensating.ReleaseReservation"><rect fill="#F1F1F1" height="40" rx="4" ry="4" style="stroke:#181818;stroke-width:0.4;" width="116.8547" x="328" y="584.1938"/><line style="stroke:#181818;stroke-width:0.4;" x1="328" x2="444.8547" y1="607.0906" y2="607.0906"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="100.8547" x="336" y="600.2797">ReleaseReservation</text></g><ellipse cx="386.4" cy="661.7938" fill="none" rx="8.8" ry="8.8" style="stroke:#222222;stroke-width:0.8;"/><ellipse cx="386.4" cy="661.7938" fill="#222222" rx="4.8" ry="4.8" style="stroke:#222222;stroke-width:0.8;"/><!--link *start*Compensating to CancelLending--><g class="link" data-entity-1="*start*Compensating" data-entity-2="CancelLending" data-source-line="21" data-uid="lnk16" id="link_*start*Compensating_CancelLending"><path d="M386.4,486.6098 C386.4,493.8578 386.4,500.5458 386.4,510.4578" fill="none" id="*start*Compensating-to-CancelLending" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="386.4,515.2578,389.6,508.0578,386.4,511.2578,383.2,508.0578,386.4,515.2578" style="stroke:#181818;stroke-width:0.8;"/></g><!--link CancelLending to ReleaseReservation--><g class="link" data-entity-1="CancelLending" data-entity-2="ReleaseReservation" data-source-line="22" data-uid="lnk18" id="link_CancelLending_ReleaseReservation"><path d="M386.4,555.6338 C386.4,564.5458 386.4,570.2898 386.4,579.2018" fill="none" id="CancelLending-to-ReleaseReservation" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="386.4,584.0018,389.6,576.8018,386.4,580.0018,383.2,576.8018,386.4,584.0018" style="stroke:#181818;stroke-width:0.8;"/></g><!--link ReleaseReservation to *end*Compensating--><g class="link" data-entity-1="ReleaseReservation" data-entity-2="*end*Compensating" data-source-line="23" data-uid="lnk20" id="link_ReleaseReservation_*end*Compensating"><path d="M386.4,624.2658 C386.4,634.0098 386.4,640.5218 386.4,647.9858" fill="none" id="ReleaseReservation-to-*end*Compensating" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="386.4,652.7858,389.6,645.5858,386.4,648.7858,383.2,645.5858,386.4,652.7858" style="stroke:#181818;stroke-width:0.8;"/></g><g id="Completed"><rect fill="#DDFFDD" height="40" rx="4" ry="4" style="stroke:#181818;stroke-width:0.4;" width="70.1625" x="570" y="830.8969"/><line style="stroke:#181818;stroke-width:0.4;" x1="570" x2="640.1625" y1="853.7938" y2="853.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="54.1625" x="578" y="846.9828">Completed</text></g><g id="Failed"><rect fill="#FFDDDD" height="40" rx="4" ry="4" style="stroke:#181818;stroke-width:0.4;" width="46.5047" x="208.4" y="742.0969"/><line style="stroke:#181818;stroke-width:0.4;" x1="208.4" x2="254.9047" y1="764.9938" y2="764.9938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="30.5047" x="216.4" y="758.1828">Failed</text></g><g id="Started"><rect fill="#FFFFDD" height="40" rx="4" ry="4" style="stroke:#181818;stroke-width:0.4;" width="52.1102" x="5.6" y="129.2969"/><line style="stroke:#181818;stroke-width:0.4;" x1="5.6" x2="57.7102" y1="152.1938" y2="152.1938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="36.1102" x="13.6" y="145.3828">Started</text></g><g id="Reserved"><rect fill="#FFFFDD" height="40" rx="4" ry="4" style="stroke:#181818;stroke-width:0.4;" width="63.9336" x="199.6" y="232.4969"/><line style="stroke:#181818;stroke-width:0.4;" x1="199.6" x2="263.5336" y1="255.3938" y2="255.3938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="47.9336" x="207.6" y="248.5828">Reserved</text></g><g id="LendingCreated"><rect fill="#FFFFDD" height="40" rx="4" ry="4" style="stroke:#181818;stroke-width:0.4;" width="95.707" x="365.2" y="335.6969"/><line style="stroke:#181818;stroke-width:0.4;" x1="365.2" x2="460.907" y1="358.5938" y2="358.5938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="79.707" x="373.2" y="351.7828">LendingCreated</text></g><g id="Confirmed"><rect fill="#DDFFFF" height="40" rx="4" ry="4" style="stroke:#181818;stroke-width:0.4;" width="67.6633" x="575.2" y="538.8969"/><line style="stroke:#181818;stroke-width:0.4;" x1="575.2" x2="642.8633" y1="561.7938" y2="561.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="51.6633" x="583.2" y="554.9828">Confirmed</text></g><g id="PaymentCaptured"><rect fill="#DDFFFF" height="40" rx="4" ry="4" style="stroke:#181818;stroke-width:0.4;" width="106.2727" x="720.8" y="742.0969"/><line style="stroke:#181818;stroke-width:0.4;" x1="720.8" x2="827.0727" y1="764.9938" y2="764.9938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="90.2727" x="728.8" y="758.1828">PaymentCaptured</text></g><ellipse cx="31.6" cy="44.4969" fill="#222222" rx="8" ry="8" style="stroke:#222222;stroke-width:0.8;"/><!--link *start* to Started--><g class="link" data-entity-1="*start*" data-entity-2="Started" data-source-line="7" data-uid="lnk3" id="link_*start*_Started"><path d="M31.6,52.7209 C31.6,68.5689 31.6,101.3689 31.6,124.4649" fill="none" id="*start*-to-Started" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="31.6,129.2649,34.8,122.0649,31.6,125.2649,28.4,122.0649,31.6,129.2649" style="stroke:#181818;stroke-width:0.8;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="65.8836" x="39.9182" y="88.5195">POST /borrow</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="80.9199" x="32.4" y="102.3523">(create saga row)</text></g><!--link Started to Reserved--><g class="link" data-entity-1="Started" data-entity-2="Reserved" data-source-line="8" data-uid="lnk4" id="link_Started_Reserved"><path d="M57.744,163.3769 C94.168,181.8809 155.8482,213.2195 195.2162,233.2115" fill="none" id="Started-to-Reserved" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="199.496,235.3849,194.5253,229.2716,195.9295,233.5737,191.6274,234.978,199.496,235.3849" style="stroke:#181818;stroke-width:0.8;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="110.9824" x="144.4" y="205.3195">inventory.copy-reserved</text></g><!--link Reserved to LendingCreated--><g class="link" data-entity-1="Reserved" data-entity-2="LendingCreated" data-source-line="9" data-uid="lnk5" id="link_Reserved_LendingCreated"><path d="M263.648,271.2249 C295.928,289.2889 341.3711,314.7131 374.4991,333.2491" fill="none" id="Reserved-to-LendingCreated" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="378.688,335.5929,373.9672,329.2846,375.1973,333.6397,370.8422,334.8698,378.688,335.5929" style="stroke:#181818;stroke-width:0.8;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="71.1191" x="334" y="308.5195">lending.created</text></g><!--link LendingCreated to Confirmed--><g class="link" data-entity-1="LendingCreated" data-entity-2="Confirmed" data-source-line="10" data-uid="lnk6" id="link_LendingCreated_Confirmed"><path d="M461.304,363.4409 C503.808,370.5609 561.416,382.9689 577.2,399.6969 C613.488,438.1609 614.0382,501.0777 611.6222,534.1017" fill="none" id="LendingCreated-to-Confirmed" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="611.272,538.8889,614.9888,531.9416,611.5639,534.8995,608.6059,531.4746,611.272,538.8889" style="stroke:#181818;stroke-width:0.8;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="145.6609" x="588.4" y="411.7195">inventory.reservation-confirmed</text></g><!--link Confirmed to PaymentCaptured--><g class="link" data-entity-1="Confirmed" data-entity-2="PaymentCaptured" data-source-line="11" data-uid="lnk7" id="link_Confirmed_PaymentCaptured"><path d="M625,579.0249 C656.504,617.5609 723.746,699.8206 755.21,738.3086" fill="none" id="Confirmed-to-PaymentCaptured" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="758.248,742.0249,756.1684,734.4252,755.7163,738.928,751.2135,738.4759,758.248,742.0249" style="stroke:#181818;stroke-width:0.8;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="83.2508" x="738.8" y="714.9195">payment.captured</text></g><!--link PaymentCaptured to Completed--><g class="link" data-entity-1="PaymentCaptured" data-entity-2="Completed" data-source-line="12" data-uid="lnk8" id="link_PaymentCaptured_Completed"><path d="M736.744,782.1449 C708.104,796.9369 673.0648,815.0382 644.8888,829.5902" fill="none" id="PaymentCaptured-to-Completed" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="640.624,831.7929,648.4896,831.3321,644.178,829.9574,645.5528,825.6457,640.624,831.7929" style="stroke:#181818;stroke-width:0.8;"/></g><!--link Confirmed to Completed--><g class="link" data-entity-1="Confirmed" data-entity-2="Completed" data-source-line="13" data-uid="lnk9" id="link_Confirmed_Completed"><path d="M608.232,579.0329 C606.408,617.6249 602.72,706.9769 603.6,782.0969 C603.792,798.5129 604.1154,812.3467 604.4914,825.9547" fill="none" id="Confirmed-to-Completed" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="604.624,830.7529,607.6239,823.4672,604.5135,826.7544,601.2264,823.644,604.624,830.7529" style="stroke:#181818;stroke-width:0.8;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="102.3191" x="604.4" y="766.5195">(no payment required)</text></g><!--link Started to Failed--><g class="link" data-entity-1="Started" data-entity-2="Failed" data-source-line="15" data-uid="lnk10" id="link_Started_Failed"><path d="M24.384,169.6489 C17.576,189.8889 8.4,222.5689 8.4,251.6969 C8.4,251.6969 8.4,251.6969 8.4,559.6969 C8.4,666.6089 146.6879,729.7628 203.8559,751.4428" fill="none" id="Started-to-Failed" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="208.344,753.1449,202.7465,747.5998,204.6039,751.7265,200.4772,753.5839,208.344,753.1449" style="stroke:#181818;stroke-width:0.8;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="179.7707" x="9.2" y="360.1195">inventory.reservation-rejected / timeout</text></g><!--link Reserved to Failed--><g class="link" data-entity-1="Reserved" data-entity-2="Failed" data-source-line="16" data-uid="lnk11" id="link_Reserved_Failed"><path d="M231.6,272.5929 C231.6,353.0569 231.6,656.6809 231.6,737.1849" fill="none" id="Reserved-to-Failed" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="231.6,741.9849,234.8,734.7849,231.6,737.9849,228.4,734.7849,231.6,741.9849" style="stroke:#181818;stroke-width:0.8;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="148.5707" x="232.4" y="411.7195">lending.create-rejected / timeout</text></g><!--link LendingCreated to Compensating--><g class="link" data-entity-1="LendingCreated" data-entity-2="Compensating" data-source-line="17" data-uid="lnk12" id="link_LendingCreated_Compensating"><path d="M410.512,375.8249 C408.376,391.2489 405.8364,409.5185 402.4284,434.0545" fill="none" id="LendingCreated-to-Compensating" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="401.768,438.8089,405.9281,432.1176,402.3183,434.8469,399.589,431.2371,401.768,438.8089" style="stroke:#181818;stroke-width:0.8;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="162.4188" x="407.6" y="411.7195">inventory.confirm-rejected / timeout</text></g><!--link Compensating to Failed--><g class="link" data-entity-1="Compensating" data-entity-2="Failed" data-source-line="18" data-uid="lnk13" id="link_Compensating_Failed"><path d="M318.272,647.5369 C291.432,682.7609 265.8687,716.3185 249.1647,738.2465" fill="none" id="Compensating-to-Failed" style="stroke:#181818;stroke-width:0.8;"/><polygon fill="#181818" points="246.256,742.0649,253.1646,738.2765,248.6799,738.8829,248.0735,734.3983,246.256,742.0649" style="stroke:#181818;stroke-width:0.8;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="232.116" x="274" y="714.9195">lending.cancelled + inventory.reservation-released</text></g><!--SRC=[VLDDKy8m4BtdL-mC5z0fwDM31ylqf0CZtjH3J1SQQPEw2J2CutytIJze2zfRNjvx-xAxjTBc20iI6HfBt68AAxxX4C7AkXCySP59XJ1-q4Jw00TfCtX6WxJdLcerOSnifIevyG8-kDXkIEzK6kjS4upMuUimJCPJVP1g0skU6-pSr39II71xmzZhrJj4qRsFGJxL7ImNgnUOVOGSRsei27r0uzCwPC8QfbTL2ODCgZqgg-au5ReyHbJVi9RY-O-eKfSg3fvUbLV0jAgIiW71QsAjrfAAGH4wzIOI3OETk5wvvCV2qMDUsXq5VLaXKr53R4Yf2XPbZlRChiMTqLZfnWm8ltRIYTsCkhr9kCp_2KtuYS9pPs1bWNfd-wrgvVqMNT9TR5fHeZAkbDk1_d32aoxPz3IN8t0bCFVOzP-lof4RrpfcmbxtFByPGBDlSR2gapkyTwvtArXrVW97EmS3rxcodsxDQawZ-Jn9vlCQhvypyb0BDXDpQ8VQJg8F3nhTlpmjIoYR93K-NB7czXS0]--></g></svg>